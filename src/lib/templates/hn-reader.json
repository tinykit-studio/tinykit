{
	"id": "hn-reader",
	"name": "HN Reader",
	"description": "Minimal Hacker News reader with comments, read tracking, and saved stories",
	"preview": "lucide:newspaper",
	"tags": [
		"news",
		"intermediate",
		"api",
		"database"
	],
	"kits": [
		"feeds",
		"developer"
	],
	"frontend_code": "<script>\n\timport { fade } from \"svelte/transition\";\n\timport { untrack } from \"svelte\";\n\timport Icon from \"@iconify/svelte\";\n\timport content from \"$content\";\n\timport data from \"$data\";\n\timport { proxy } from '$tinykit';\n\n\t// Application State\n\tlet stories = $state([]);\n\tlet loading = $state(true);\n\tlet error = $state(null);\n\tlet feed = $state(\"top\");\n\tlet view = $state(\"feed\"); // \"feed\" or \"saved\"\n\tlet read_ids = $state(new Set());\n\tlet dark_mode = $state(false);\n\t\n\n\t// Saved stories state\n\tlet saved_stories = $state([]);\n\tlet saved_loading = $state(true);\n\tlet saved_map = $derived.by(() => {\n\t\tconst map = new Map();\n\t\tsaved_stories.forEach(r => map.set(r.story_id, r.id));\n\t\treturn map;\n\t});\n\n\t// Modal/Comment State\n\tlet selected_id = $state(null);\n\tlet selected_story = $state(null);\n\tlet loading_story = $state(false);\n\tlet comments_tree = $state([]);\n\n\tconst discussion_cache = new Map();\n\n\tconst feeds = [\n\t\t{ id: \"top\", name: \"Top\", endpoint: \"topstories\" },\n\t\t{ id: \"new\", name: \"New\", endpoint: \"newstories\" },\n\t\t{ id: \"best\", name: \"Best\", endpoint: \"beststories\" },\n\t\t{ id: \"ask\", name: \"Ask\", endpoint: \"askstories\" },\n\t\t{ id: \"show\", name: \"Show\", endpoint: \"showstories\" },\n\t];\n\n\t// --- Routing Logic ---\n\n\tfunction get_view_from_path() {\n\t\tconst path = window.location.pathname.replace(\"/\", \"\");\n\t\tif (path === \"saved\") return \"saved\";\n\t\treturn \"feed\";\n\t}\n\n\tfunction get_feed_from_path() {\n\t\tconst path = window.location.pathname.replace(\"/\", \"\");\n\t\tif (path === \"saved\") return \"top\";\n\t\treturn feeds.find((f) => f.id === path) ? path : \"top\";\n\t}\n\n\tfunction get_id_from_hash() {\n\t\tconst hash = window.location.hash;\n\t\tif (hash.startsWith(\"#item=\")) return hash.split(\"=\")[1];\n\t\treturn null;\n\t}\n\n\tfunction navigate_feed(e, new_feed_id) {\n\t\te.preventDefault();\n\t\tconst url = new_feed_id === \"top\" ? \"/\" : `/${new_feed_id}`;\n\t\twindow.history.pushState({}, \"\", url);\n\t\tview = \"feed\";\n\t\tfeed = new_feed_id;\n\t\tfetch_stories(new_feed_id);\n\t}\n\n\tfunction navigate_saved(e) {\n\t\te.preventDefault();\n\t\twindow.history.pushState({}, \"\", \"/saved\");\n\t\tview = \"saved\";\n\t}\n\n\tfunction close_modal() {\n\t\thistory.pushState(\n\t\t\t\"\",\n\t\t\tdocument.title,\n\t\t\twindow.location.pathname + window.location.search,\n\t\t);\n\t\tselected_id = null;\n\t\tselected_story = null;\n\t\tcomments_tree = [];\n\t}\n\n\t// Initialize Read State\n\t$effect(() => {\n\t\tconst stored = localStorage.getItem('hn_read_ids');\n\t\tif (stored) read_ids = new Set(JSON.parse(stored));\n\t});\n\n\t// Initialize dark mode\n\t$effect(() => {\n\t\tconst stored = localStorage.getItem('hn_dark_mode');\n\t\tif (stored !== null) dark_mode = stored === 'true';\n\t});\n\n\tfunction toggle_dark_mode() {\n\t\tdark_mode = !dark_mode;\n\t\tlocalStorage.setItem('hn_dark_mode', String(dark_mode));\n\t}\n\n\tfunction mark_read(id) {\n\t\tif (!id || read_ids.has(id)) return;\n\t\tconst new_set = new Set(read_ids);\n\t\tnew_set.add(id);\n\t\tread_ids = new_set;\n\t\tlocalStorage.setItem('hn_read_ids', JSON.stringify([...read_ids]));\n\t}\n\n\t// Subscribe to saved stories with realtime updates\n\tdata.saved.subscribe(items => {\n\t\t\t// Sort by created descending (newest first)\n\t\tsaved_stories = [...items].sort((a, b) => \n\t\t\tnew Date(b.created).getTime() - new Date(a.created).getTime()\n\t\t);\n\t\tsaved_loading = false;\n\t});\n\n\tasync function toggle_save(story) {\n\t\tconst story_id = story.id;\n\t\tif (saved_map.has(story_id)) {\n\t\t\t// Unsave\n\t\t\tconst record_id = saved_map.get(story_id);\n\t\t\ttry {\n\t\t\t\tawait data.saved.delete(record_id);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error('Failed to unsave:', e);\n\t\t\t}\n\t\t} else {\n\t\t\t// Save\n\t\t\ttry {\n\t\t\t\tawait data.saved.create({\n\t\t\t\t\tstory_id: story_id,\n\t\t\t\t\ttitle: story.title,\n\t\t\t\t\turl: story.url || '',\n\t\t\t\t\tby: story.by,\n\t\t\t\t\tscore: story.score,\n\t\t\t\t\tdescendants: story.descendants || 0\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error('Failed to save:', e);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Event handlers defined outside effects to avoid reactive dependencies\n\tfunction handle_popstate() {\n\t\tview = get_view_from_path();\n\t\tif (view === \"feed\") {\n\t\t\tfeed = get_feed_from_path();\n\t\t\tfetch_stories(feed);\n\t\t}\n\t\tselected_id = get_id_from_hash();\n\t\tif (selected_id) load_discussion(selected_id);\n\t}\n\n\tfunction handle_hash() {\n\t\tconst id = get_id_from_hash();\n\t\tif (id && id !== selected_id) {\n\t\t\tselected_id = id;\n\t\t\tload_discussion(id);\n\t\t} else if (!id) {\n\t\t\tselected_id = null;\n\t\t}\n\t}\n\n\t// Setup event listeners\n\t$effect(() => {\n\t\twindow.addEventListener(\"popstate\", handle_popstate);\n\t\twindow.addEventListener(\"hashchange\", handle_hash);\n\n\t\t// Initial load (only runs once due to untrack)\n\t\tuntrack(() => {\n\t\t\tview = get_view_from_path();\n\t\t\tif (view === \"feed\") {\n\t\t\t\tfeed = get_feed_from_path();\n\t\t\t\tfetch_stories(feed);\n\t\t\t}\n\n\t\t\tconst initial_id = get_id_from_hash();\n\t\t\tif (initial_id) {\n\t\t\t\tselected_id = initial_id;\n\t\t\t\tload_discussion(initial_id);\n\t\t\t}\n\t\t});\n\n\t\treturn () => {\n\t\t\twindow.removeEventListener(\"popstate\", handle_popstate);\n\t\t\twindow.removeEventListener(\"hashchange\", handle_hash);\n\t\t};\n\t});\n\n\t// Close on Escape\n\t$effect(() => {\n\t\tconst handle_keydown = (e) => {\n\t\t\tif (e.key === \"Escape\" && selected_id) {\n\t\t\t\tclose_modal();\n\t\t\t}\n\t\t};\n\t\twindow.addEventListener(\"keydown\", handle_keydown);\n\t\treturn () => window.removeEventListener(\"keydown\", handle_keydown);\n\t});\n\n\t// --- Data Fetching ---\n\n\tasync function fetch_stories(feed_id) {\n\t\tif (stories.length === 0) loading = true;\n\t\terror = null;\n\t\ttry {\n\t\t\tconst feed_config = feeds.find((f) => f.id === feed_id);\n\t\t\tconst response = await fetch(\n\t\t\t\t`https://hacker-news.firebaseio.com/v0/${feed_config.endpoint}.json`,\n\t\t\t);\n\t\t\tconst story_ids = await response.json();\n\n\t\t\tconst story_promises = story_ids.slice(0, 30).map(async (id) => {\n\t\t\t\tconst r = await fetch(\n\t\t\t\t\t`https://hacker-news.firebaseio.com/v0/item/${id}.json`,\n\t\t\t\t);\n\t\t\t\treturn r.json();\n\t\t\t});\n\n\t\t\tstories = await Promise.all(story_promises);\n\t\t\tloading = false;\n\t\t} catch (e) {\n\t\t\terror = \"Failed to load stories\";\n\t\t\tloading = false;\n\t\t}\n\t}\n\n\t// --- Scraping & Prefetching Logic ---\n\n\tasync function get_discussion_data(id) {\n\t\tif (discussion_cache.has(id)) {\n\t\t\treturn discussion_cache.get(id);\n\t\t}\n\n\t\tconst [api_res, html_text] = await Promise.all([\n\t\t\tfetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`).then(r => r.json()),\n\t\t\tproxy.text(`https://news.ycombinator.com/item?id=${id}`)\n\t\t]);\n\n\t\tconst comments = parse_hn_html(html_text);\n\t\tconst result = { story: api_res, comments };\n\t\tdiscussion_cache.set(id, result);\n\t\treturn result;\n\t}\n\n\tasync function prefetch(id) {\n\t\tif (discussion_cache.has(id)) return;\n\t\ttry {\n\t\t\tawait get_discussion_data(id);\n\t\t} catch (e) {}\n\t}\n\n\tasync function load_discussion(id) {\n\t\tloading_story = true;\n\t\tconst existing = stories.find(s => s.id == id);\n\t\tselected_story = existing || null;\n\t\tcomments_tree = [];\n\t\tmark_read(parseInt(id));\n\n\t\ttry {\n\t\t\tconst result = await get_discussion_data(id);\n\t\t\tif (selected_id == id) {\n\t\t\t\tselected_story = result.story;\n\t\t\t\tcomments_tree = result.comments;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Scraping failed:\", e);\n\t\t} finally {\n\t\t\tloading_story = false;\n\t\t}\n\t}\n\n\tfunction parse_hn_html(html) {\n\t\tconst parser = new DOMParser();\n\t\tconst doc = parser.parseFromString(html, \"text/html\");\n\t\tconst rows = Array.from(doc.querySelectorAll(\"tr.athing.comtr\"));\n\t\tconst comments = [];\n\t\tconst stack = [];\n\n\t\trows.forEach((row) => {\n\t\t\ttry {\n\t\t\t\tconst indent_img = row.querySelector(\".ind img\");\n\t\t\t\tconst indent_px = indent_img ? parseInt(indent_img.getAttribute(\"width\")) : 0;\n\t\t\t\tconst level = indent_px / 40;\n\n\t\t\t\tconst text_div = row.querySelector(\".comment\");\n\t\t\t\tconst user_link = row.querySelector(\".hnuser\");\n\t\t\t\tconst age_span = row.querySelector(\".age\");\n\n\t\t\t\tif (text_div) {\n\t\t\t\t\tconst reply = text_div.querySelector(\".reply\");\n\t\t\t\t\tif (reply) reply.remove();\n\t\t\t\t}\n\n\t\t\t\tconst comment = {\n\t\t\t\t\tid: row.id,\n\t\t\t\t\tuser: user_link ? user_link.textContent : \"[deleted]\",\n\t\t\t\t\ttime_ago: age_span ? age_span.textContent : \"\",\n\t\t\t\t\thtml: text_div ? text_div.innerHTML : \"[deleted]\",\n\t\t\t\t\tkids: [],\n\t\t\t\t};\n\n\t\t\t\tif (level === 0) {\n\t\t\t\t\tcomments.push(comment);\n\t\t\t\t\tstack[0] = comment;\n\t\t\t\t} else {\n\t\t\t\t\tconst parent = stack[level - 1];\n\t\t\t\t\tif (parent) {\n\t\t\t\t\t\tparent.kids.push(comment);\n\t\t\t\t\t\tstack[level] = comment;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tconsole.warn(\"Skipped parsing row\", err);\n\t\t\t}\n\t\t});\n\n\t\treturn comments;\n\t}\n\n\tfunction get_domain(url) {\n\t\tif (!url) return null;\n\t\ttry { return new URL(url).hostname.replace(\"www.\", \"\"); } catch { return null; }\n\t}\n\n\tfunction time_ago(timestamp) {\n\t\tconst seconds = Math.floor(Date.now() / 1000 - timestamp);\n\t\tif (seconds < 60) return \"just now\";\n\t\tif (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;\n\t\tif (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;\n\t\treturn `${Math.floor(seconds / 86400)}d ago`;\n\t}\n\n\t// Convert saved record to story-like object\n\tfunction saved_to_story(saved) {\n\t\treturn {\n\t\t\tid: saved.story_id,\n\t\t\ttitle: saved.title,\n\t\t\turl: saved.url,\n\t\t\tby: saved.by,\n\t\t\tscore: saved.score,\n\t\t\tdescendants: saved.descendants\n\t\t};\n\t}\n</script>\n\n{#snippet story_item(story, i, show_save = true)}\n\t<article\n\t\tclass=\"story\"\n\t\tclass:read={read_ids.has(story.id)}\n\t\tonmouseenter={() => prefetch(story.id)}>\n\t\t{#if i !== undefined}\n\t\t\t<span class=\"rank\">{i + 1}</span>\n\t\t{/if}\n\t\t<div class=\"story-content\">\n\t\t\t<div class=\"story-title\">\n\t\t\t\t<a\n\t\t\t\t\thref={story.url ? story.url : `#item=${story.id}`}\n\t\t\t\t\ttarget={story.url ? \"_blank\" : \"_self\"}\n\t\t\t\t\tonclick={() => mark_read(story.id)}>\n\t\t\t\t\t{story.title}\n\t\t\t\t</a>\n\t\t\t\t{#if get_domain(story.url)}\n\t\t\t\t\t<span class=\"domain\">({get_domain(story.url)})</span>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t\t<div class=\"story-meta\">\n\t\t\t\t<span class=\"points\">\n\t\t\t\t\t<Icon icon=\"lucide:arrow-up\" width={12} />\n\t\t\t\t\t{story.score}\n\t\t\t\t</span>\n\t\t\t\t<span class=\"by\">by {story.by}</span>\n\t\t\t\t<span class=\"time\">{story.time ? time_ago(story.time) : \"\"}</span>\n\t\t\t\t<a href=\"#item={story.id}\" class=\"comments\">\n\t\t\t\t\t<Icon icon=\"lucide:message-square\" width={12} />\n\t\t\t\t\t{story.descendants || 0}\n\t\t\t\t</a>\n\t\t\t\t{#if show_save}\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"save-btn\"\n\t\t\t\t\t\tclass:saved={saved_map.has(story.id)}\n\t\t\t\t\t\tonclick={(e) => { e.preventDefault(); toggle_save(story); }}\n\t\t\t\t\t\ttitle={saved_map.has(story.id) ? \"Unsave\" : \"Save\"}>\n\t\t\t\t\t\t<Icon icon={saved_map.has(story.id) ? \"lucide:bookmark-check\" : \"lucide:bookmark\"} width={12} />\n\t\t\t\t\t</button>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t</article>\n{/snippet}\n\n{#snippet comment_node(comment)}\n\t<div class=\"comment-item\">\n\t\t<div class=\"comment-meta\">\n\t\t\t<span class=\"by\">{comment.user}</span>\n\t\t\t<span class=\"time\">{comment.time_ago}</span>\n\t\t</div>\n\t\t<div class=\"comment-text\">\n\t\t\t{@html comment.html}\n\t\t</div>\n\t\t{#if comment.kids.length > 0}\n\t\t\t<div class=\"comment-children\">\n\t\t\t\t{#each comment.kids as kid (kid.id)}\n\t\t\t\t\t{@render comment_node(kid)}\n\t\t\t\t{/each}\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n{/snippet}\n\n<div class=\"page\" class:dark={dark_mode}>\n\t<header class=\"header\">\n\t\t<div class=\"header-inner\">\n\t\t\t<div class=\"header-left\">\n\t\t\t\t<a href=\"/\" class=\"logo\" onclick={(e) => navigate_feed(e, 'top')}>\n\t\t\t\t\t<Icon icon=\"lucide:flame\" width={24} />\n\t\t\t\t\t<h1>{content.app_title}</h1>\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t\t<div class=\"header-right\">\n\t\t\t\t<button class=\"theme-toggle\" onclick={toggle_dark_mode} title={dark_mode ? 'Light mode' : 'Dark mode'}>\n\t\t\t\t\t<Icon icon={dark_mode ? \"lucide:sun\" : \"lucide:moon\"} width={18} />\n\t\t\t\t</button>\n\t\t\t\t<a href=\"/saved\" class=\"header-link\" class:active={view === 'saved'} onclick={navigate_saved}>\n\t\t\t\t\t<Icon icon=\"lucide:bookmark\" width={16} />\n\t\t\t\t\tSaved\n\t\t\t\t\t{#if saved_stories.length > 0}\n\t\t\t\t\t\t<span class=\"badge\">{saved_stories.length}</span>\n\t\t\t\t\t{/if}\n\t\t\t\t</a>\n\t\t\t\t<a href=\"https://news.ycombinator.com\" target=\"_blank\" class=\"header-link external\">\n\t\t\t\t\t{content.visit_hn}\n\t\t\t\t\t<Icon icon=\"lucide:external-link\" width={14} />\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t</div>\n\t</header>\n\n\t<div class=\"container\">\n\t\t{#if view === \"feed\"}\n\t\t\t<nav class=\"tabs\">\n\t\t\t\t{#each feeds as f (f.id)}\n\t\t\t\t\t<a\n\t\t\t\t\t\thref=\"/{f.id === 'top' ? '' : f.id}\"\n\t\t\t\t\t\tclass=\"tab\"\n\t\t\t\t\t\tclass:active={feed === f.id}\n\t\t\t\t\t\tonclick={(e) => navigate_feed(e, f.id)}>\n\t\t\t\t\t\t{f.name}\n\t\t\t\t\t</a>\n\t\t\t\t{/each}\n\t\t\t</nav>\n\n\t\t\t<main class=\"stories\">\n\t\t\t\t{#if loading}\n\t\t\t\t\t<div class=\"loading\">\n\t\t\t\t\t\t<Icon icon=\"lucide:loader-2\" width={24} class=\"spin\" />\n\t\t\t\t\t\t<p>{content.loading_message}</p>\n\t\t\t\t\t</div>\n\t\t\t\t{:else if error}\n\t\t\t\t\t<div class=\"error\">\n\t\t\t\t\t\t<p>{error}</p>\n\t\t\t\t\t\t<button onclick={() => fetch_stories(feed)}>{content.retry_button}</button>\n\t\t\t\t\t</div>\n\t\t\t\t{:else}\n\t\t\t\t\t{#each stories as story, i (story.id)}\n\t\t\t\t\t\t{@render story_item(story, i)}\n\t\t\t\t\t{/each}\n\t\t\t\t{/if}\n\t\t\t</main>\n\t\t{:else}\n\t\t\t<div class=\"saved-header\">\n\t\t\t\t<h2>\n\t\t\t\t\t<Icon icon=\"lucide:bookmark\" width={20} />\n\t\t\t\t\tSaved Stories\n\t\t\t\t</h2>\n\t\t\t\t<span class=\"saved-count\">{saved_stories.length} {saved_stories.length === 1 ? 'story' : 'stories'}</span>\n\t\t\t</div>\n\n\t\t\t<main class=\"stories\">\n\t\t\t\t{#if saved_loading}\n\t\t\t\t\t<div class=\"loading\">\n\t\t\t\t\t\t<Icon icon=\"lucide:loader-2\" width={24} class=\"spin\" />\n\t\t\t\t\t\t<p>Loading saved stories...</p>\n\t\t\t\t\t</div>\n\t\t\t\t{:else if saved_stories.length === 0}\n\t\t\t\t\t<div class=\"empty-state\">\n\t\t\t\t\t\t<Icon icon=\"lucide:bookmark\" width={48} />\n\t\t\t\t\t\t<p>No saved stories yet</p>\n\t\t\t\t\t\t<a href=\"/\" onclick={(e) => navigate_feed(e, 'top')}>Browse stories</a>\n\t\t\t\t\t</div>\n\t\t\t\t{:else}\n\t\t\t\t\t{#each saved_stories as saved (saved.id)}\n\t\t\t\t\t\t{@render story_item(saved_to_story(saved), undefined, true)}\n\t\t\t\t\t{/each}\n\t\t\t\t{/if}\n\t\t\t</main>\n\t\t{/if}\n\t</div>\n\n\t{#if selected_id}\n\t\t<div\n\t\t\tclass=\"modal-backdrop\"\n\t\t\tonclick={close_modal}\n\t\t\trole=\"presentation\"\n\t\t\t>\n\t\t\t<div\n\t\t\t\tclass=\"modal-content\"\n\t\t\t\tonclick={(e) => e.stopPropagation()}\n\t\t\t\trole=\"dialog\">\n\t\t\t\t<div class=\"modal-header\">\n\t\t\t\t\t{#if selected_story}\n\t\t\t\t\t\t<div class=\"header-story\">\n\t\t\t\t\t\t\t<h3 class=\"header-title\">\n\t\t\t\t\t\t\t\t{#if selected_story.url}\n\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\thref={selected_story.url}\n\t\t\t\t\t\t\t\t\t\ttarget=\"_blank\">\n\t\t\t\t\t\t\t\t\t\t{selected_story.title}\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\t\thref=\"https://news.ycombinator.com/item?id={selected_story.id}\"\n\t\t\t\t\t\t\t\t\t\ttarget=\"_blank\">\n\t\t\t\t\t\t\t\t\t\t{selected_story.title}\n\t\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t{#if get_domain(selected_story.url)}\n\t\t\t\t\t\t\t\t\t<span class=\"header-domain\"\n\t\t\t\t\t\t\t\t\t\t>({get_domain(selected_story.url)})</span>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t<a\n\t\t\t\t\t\t\t\t\thref=\"https://news.ycombinator.com/item?id={selected_story.id}\"\n\t\t\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\t\t\tclass=\"hn-link\"\n\t\t\t\t\t\t\t\t\ttitle=\"View on Hacker News\">\n\t\t\t\t\t\t\t\t\t<Icon icon=\"lucide:external-link\" width={14} />\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</h3>\n\t\t\t\t\t\t\t<div class=\"header-meta\">\n\t\t\t\t\t\t\t\t<Icon icon=\"lucide:arrow-up\" width={12} />\n\t\t\t\t\t\t\t\t<span>{selected_story.score} points</span>\n\t\t\t\t\t\t\t\t<span class=\"sep\">\u2022</span>\n\t\t\t\t\t\t\t\t<span>by {selected_story.by}</span>\n\t\t\t\t\t\t\t\t<span class=\"sep\">\u2022</span>\n\t\t\t\t\t\t\t\t<span\n\t\t\t\t\t\t\t\t\t>{selected_story.time\n\t\t\t\t\t\t\t\t\t\t? time_ago(selected_story.time)\n\t\t\t\t\t\t\t\t\t\t: \"\"}</span>\n\t\t\t\t\t\t\t\t<span class=\"sep\">\u2022</span>\n\t\t\t\t\t\t\t\t<span>{selected_story.descendants || 0} comments</span>\n\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\tclass=\"save-btn modal-save\"\n\t\t\t\t\t\t\t\t\tclass:saved={saved_map.has(selected_story.id)}\n\t\t\t\t\t\t\t\t\tonclick={() => toggle_save(selected_story)}>\n\t\t\t\t\t\t\t\t\t<Icon\n\t\t\t\t\t\t\t\t\t\ticon={saved_map.has(selected_story.id)\n\t\t\t\t\t\t\t\t\t\t\t? \"lucide:bookmark-check\"\n\t\t\t\t\t\t\t\t\t\t\t: \"lucide:bookmark\"}\n\t\t\t\t\t\t\t\t\t\twidth={14} />\n\t\t\t\t\t\t\t\t\t{saved_map.has(selected_story.id) ? \"Saved\" : \"Save\"}\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{:else}\n\t\t\t\t\t\t<h3>Loading...</h3>\n\t\t\t\t\t{/if}\n\t\t\t\t\t<button class=\"close-btn\" onclick={close_modal}>\n\t\t\t\t\t\t<Icon icon=\"lucide:x\" width={24} />\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\n\t\t\t\t<div class=\"modal-body\">\n\t\t\t\t\t{#if loading_story && !selected_story}\n\t\t\t\t\t\t<div class=\"loading-modal\">\n\t\t\t\t\t\t\t<Icon icon=\"lucide:loader-2\" width={32} class=\"spin\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{:else if selected_story}\n\t\t\t\t\t\t{#if selected_story.text}\n\t\t\t\t\t\t\t<div class=\"op-text\">{@html selected_story.text}</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t<div class=\"comments-section\">\n\t\t\t\t\t\t\t{#if comments_tree.length > 0}\n\t\t\t\t\t\t\t\t{#each comments_tree as comment (comment.id)}\n\t\t\t\t\t\t\t\t\t{@render comment_node(comment)}\n\t\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t\t{:else if loading_story}\n\t\t\t\t\t\t\t\t<div class=\"loading-modal\">\n\t\t\t\t\t\t\t\t\t<Icon icon=\"lucide:loader-2\" width={32} class=\"spin\" />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<p class=\"no-comments\">\n\t\t\t\t\t\t\t\t\tNo comments found or discussion is empty.\n\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n\n\t<footer class=\"footer\">\n\t\tbuilt with <a href=\"https://tinykit.studio\" target=\"_blank\">tinykit.studio</a>\n\t</footer>\n</div>\n\n<style>\n\t.page {\n\t\tmin-height: 100vh;\n\t\tbackground: var(--page-background, #fafafa);\n\t\tfont-family: var(--body-font, system-ui, sans-serif);\n\t}\n\n\t.header {\n\t\tbackground: var(--header-background, #ff6600);\n\t\tcolor: #ffffff;\n\t}\n\n\t.header-inner {\n\t\tmax-width: 900px;\n\t\tmargin: 0 auto;\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tpadding: 1rem 1rem;\n\t}\n\n\t.header-left {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t}\n\n\t.logo {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 8px;\n\t\tcolor: inherit;\n\t\ttext-decoration: none;\n\t}\n\n\t.header h1 {\n\t\tmargin: 0;\n\t\tfont-size: 1.125rem;\n\t\tfont-weight: 700;\n\t}\n\n\t.header-right {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 16px;\n\t}\n\n\t.header-link {\n\t\tcolor: rgba(255, 255, 255, 0.9);\n\t\ttext-decoration: none;\n\t\tfont-size: 0.8rem;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 4px;\n\t\tpadding: 6px 10px;\n\t\tborder-radius: 6px;\n\t\ttransition: background 0.15s;\n\t}\n\n\t.header-link:hover {\n\t\tbackground: rgba(255, 255, 255, 0.15);\n\t}\n\n\t.header-link.active {\n\t\tbackground: rgba(255, 255, 255, 0.2);\n\t}\n\n\t.header-link.external {\n\t\topacity: 0.8;\n\t}\n\n\t.badge {\n\t\tbackground: rgba(255, 255, 255, 0.3);\n\t\tpadding: 2px 6px;\n\t\tborder-radius: 10px;\n\t\tfont-size: 0.7rem;\n\t\tfont-weight: 600;\n\t}\n\n\t.container {\n\t\tmax-width: 900px;\n\t\tmargin: 0 auto;\n\t}\n\n\t.tabs {\n\t\tdisplay: flex;\n\t\tgap: 4px;\n\t\tpadding: 0.75rem 1rem;\n\t\tbackground: var(--tabs-background, #ffffff);\n\t\tborder-bottom: 1px solid var(--border-color, #e5e5e5);\n\t\toverflow-x: auto;\n\t}\n\n\t.tab {\n\t\tpadding: 8px 16px;\n\t\tborder: none;\n\t\tbackground: transparent;\n\t\tcolor: var(--secondary-text-color, #666666);\n\t\tfont-size: 0.875rem;\n\t\tfont-weight: 500;\n\t\tcursor: pointer;\n\t\tborder-radius: 6px;\n\t\ttransition: all 0.15s;\n\t\ttext-decoration: none;\n\t}\n\n\t.tab:hover {\n\t\tbackground: var(--hover-background, #f5f5f5);\n\t}\n\t.tab.active {\n\t\tbackground: var(--accent-color, #ff6600);\n\t\tcolor: #ffffff;\n\t}\n\n\t.saved-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: center;\n\t\tpadding: 1rem;\n\t\tbackground: var(--tabs-background, #ffffff);\n\t\tborder-bottom: 1px solid var(--border-color, #e5e5e5);\n\t}\n\n\t.saved-header h2 {\n\t\tmargin: 0;\n\t\tfont-size: 1rem;\n\t\tfont-weight: 600;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 8px;\n\t\tcolor: var(--title-color, #1a1a1a);\n\t}\n\n\t.saved-count {\n\t\tfont-size: 0.8rem;\n\t\tcolor: var(--meta-color, #828282);\n\t}\n\n\t.stories {\n\t\tpadding: 1rem 0;\n\t}\n\n\t.story {\n\t\tdisplay: flex;\n\t\tgap: 12px;\n\t\tpadding: 12px 8px;\n\t\tborder-bottom: 1px solid var(--border-color, #e5e5e5);\n\t\ttransition: opacity 0.2s;\n\t}\n\t.story.read {\n\t\topacity: 0.6;\n\t\tbackground: rgba(0,0,0,0.02);\n\t}\n\t.story.read .rank {\n\t\topacity: 0.5;\n\t}\n\t.rank {\n\t\tcolor: var(--rank-color, #999999);\n\t\tfont-size: 0.875rem;\n\t\tfont-weight: 500;\n\t\tmin-width: 24px;\n\t\ttext-align: right;\n\t}\n\t.story-content {\n\t\tflex: 1;\n\t\tmin-width: 0;\n\t}\n\t.story-title {\n\t\tmargin-bottom: 4px;\n\t}\n\t.story-title a {\n\t\tcolor: var(--title-color, #1a1a1a);\n\t\ttext-decoration: none;\n\t\tfont-size: 0.95rem;\n\t\tline-height: 1.4;\n\t}\n\t.domain {\n\t\tcolor: var(--domain-color, #999999);\n\t\tfont-size: 0.8rem;\n\t\tmargin-left: 6px;\n\t}\n\t.story-meta {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 12px;\n\t\tfont-size: 0.75rem;\n\t\tcolor: var(--meta-color, #828282);\n\t\tflex-wrap: wrap;\n\t}\n\t.points,\n\t.comments {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 3px;\n\t}\n\t.comments {\n\t\tcolor: var(--meta-color, #828282);\n\t\ttext-decoration: none;\n\t}\n\t.comments:hover {\n\t\tcolor: var(--accent-color, #ff6600);\n\t}\n\n\t.save-btn {\n\t\tbackground: none;\n\t\tborder: none;\n\t\tcursor: pointer;\n\t\tpadding: 2px 6px;\n\t\tborder-radius: 4px;\n\t\tcolor: var(--meta-color, #828282);\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tgap: 3px;\n\t\ttransition: all 0.15s;\n\t}\n\t.save-btn:hover {\n\t\tcolor: var(--accent-color, #ff6600);\n\t\tbackground: var(--hover-background, #f5f5f5);\n\t}\n\t.save-btn.saved {\n\t\tcolor: var(--accent-color, #ff6600);\n\t}\n\n\t.modal-save {\n\t\tmargin-left: 8px;\n\t\tpadding: 4px 8px;\n\t\tfont-size: 0.75rem;\n\t}\n\n\t.empty-state {\n\t\ttext-align: center;\n\t\tpadding: 4rem 2rem;\n\t\tcolor: var(--secondary-text-color, #666666);\n\t}\n\t.empty-state :global(svg) {\n\t\topacity: 0.3;\n\t\tmargin-bottom: 1rem;\n\t}\n\t.empty-state p {\n\t\tmargin: 0 0 1rem 0;\n\t}\n\t.empty-state a {\n\t\tcolor: var(--accent-color, #ff6600);\n\t\ttext-decoration: none;\n\t}\n\n\t.loading,\n\t.error {\n\t\ttext-align: center;\n\t\tpadding: 4rem 2rem;\n\t\tcolor: var(--secondary-text-color, #666666);\n\t}\n\t.loading :global(.spin) {\n\t\tanimation: spin 1s linear infinite;\n\t}\n\t@keyframes spin {\n\t\tfrom { transform: rotate(0deg); }\n\t\tto { transform: rotate(360deg); }\n\t}\n\n\t.footer {\n\t\ttext-align: center;\n\t\tpadding: 2rem 1rem;\n\t\tfont-size: 0.75rem;\n\t\tcolor: var(--secondary-text-color, #999999);\n\t}\n\t.footer a {\n\t\tcolor: inherit;\n\t\ttext-decoration: none;\n\t}\n\n\t/* Modal & Comments */\n\t.modal-backdrop {\n\t\tposition: fixed;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\twidth: 100%;\n\t\theight: 100%;\n\t\tbackground: var(--modal-overlay, rgba(0, 0, 0, 0.5));\n\t\tbackdrop-filter: blur(2px);\n\t\t\n\t\tz-index: 1000;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t}\n\t.modal-content {\n\t\twidth: 90%;\n\t\tmax-width: 800px;\n\t\theight: 90vh;\n\t\tbackground: var(--page-background, #ffffff);\n\t\tborder-radius: 12px;\n\t\tbox-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\toverflow: hidden;\n\t}\n\n\t.modal-header {\n\t\tdisplay: flex;\n\t\tjustify-content: space-between;\n\t\talign-items: flex-start;\n\t\tpadding: 1.25rem 1.5rem;\n\t\tborder-bottom: 1px solid var(--border-color, #e5e5e5);\n\t\tbackground: var(--page-background, #ffffff);\n\t\tgap: 1rem;\n\t}\n\n\t.header-story {\n\t\tflex: 1;\n\t\tmin-width: 0;\n\t}\n\n\t.header-title {\n\t\tmargin: 0 0 6px 0;\n\t\tfont-size: 1.1rem;\n\t\tline-height: 1.3;\n\t\tfont-weight: 600;\n\t\tcolor: var(--title-color, #1a1a1a);\n\t}\n\n\t.header-title a {\n\t\ttext-decoration: none;\n\t\tcolor: inherit;\n\t}\n\t.header-title a:hover {\n\t\tcolor: var(--accent-color, #ff6600);\n\t}\n\n\t.header-domain {\n\t\tfont-weight: 400;\n\t\tcolor: var(--domain-color, #999999);\n\t\tfont-size: 0.9rem;\n\t\tmargin-left: 4px;\n\t}\n\n\t.hn-link {\n\t\tcolor: var(--meta-color, #828282);\n\t\tmargin-left: 6px;\n\t\tpadding: 2px 4px;\n\t\tborder-radius: 4px;\n\t\ttransition: all 0.15s;\n\t\tdisplay: inline-flex;\n\t\talign-items: center;\n\t\tvertical-align: middle;\n\t}\n\t.hn-link:hover {\n\t\tcolor: var(--accent-color, #ff6600);\n\t\tbackground: var(--hover-background, #f5f5f5);\n\t}\n\n\t.header-meta {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tflex-wrap: wrap;\n\t\tgap: 6px;\n\t\tcolor: var(--secondary-text-color, #666666);\n\t\tfont-size: 0.8rem;\n\t}\n\n\t.header-meta .sep {\n\t\tcolor: var(--border-color, #e5e5e5);\n\t}\n\n\t.close-btn {\n\t\tbackground: none;\n\t\tborder: none;\n\t\tcursor: pointer;\n\t\tpadding: 4px;\n\t\tborder-radius: 4px;\n\t\tcolor: var(--meta-color, #828282);\n\t\tmargin-top: -4px;\n\t}\n\t.close-btn:hover {\n\t\tbackground: var(--hover-background, #f5f5f5);\n\t\tcolor: var(--title-color, #1a1a1a);\n\t}\n\n\t.modal-body {\n\t\tflex: 1;\n\t\toverflow-y: auto;\n\t\tpadding: 0 1.5rem 2rem 1.5rem;\n\t}\n\t.loading-modal {\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\tpadding: 4rem;\n\t\tcolor: var(--meta-color, #828282);\n\t}\n\n\t.op-text {\n\t\tfont-size: 0.9rem;\n\t\tline-height: 1.6;\n\t\tcolor: var(--title-color, #1a1a1a);\n\t\tmargin-top: 1rem;\n\t\tpadding: 1rem;\n\t\tbackground: var(--hover-background, #f5f5f5);\n\t\tborder-radius: 8px;\n\t\tword-break: break-word;\n\t}\n\n\t.comments-section {\n\t\tmargin-top: 1.5rem;\n\t}\n\t.comment-item {\n\t\tmargin-bottom: 1rem;\n\t\tfont-size: 0.9rem;\n\t}\n\t.comment-meta {\n\t\tcolor: var(--meta-color, #828282);\n\t\tfont-size: 0.75rem;\n\t\tmargin-bottom: 4px;\n\t}\n\t.comment-text {\n\t\tline-height: 1.5;\n\t\tcolor: var(--title-color, #1a1a1a);\n\t\toverflow-wrap: break-word;\n\t}\n\t.comment-text :global(p) {\n\t\tmargin: 0.5rem 0;\n\t}\n\t.comment-text :global(a) {\n\t\tcolor: var(--accent-color, #ff6600);\n\t\ttext-decoration: none;\n\t}\n\t.comment-text :global(a:hover) {\n\t\ttext-decoration: underline;\n\t}\n\t.comment-text :global(pre) {\n\t\twhite-space: pre-wrap;\n\t\tbackground: var(--hover-background, #f5f5f5);\n\t\tpadding: 0.5rem;\n\t\tborder-radius: 4px;\n\t\toverflow-x: auto;\n\t}\n\n\t.comment-children {\n\t\tmargin-top: 0.75rem;\n\t\tpadding-left: 1rem;\n\t\tborder-left: 1px solid var(--border-color, #e5e5e5);\n\t}\n\t.no-comments {\n\t\ttext-align: center;\n\t\tcolor: var(--meta-color, #828282);\n\t\tpadding: 2rem;\n\t}\n\n\t/* Dark Mode */\n\t.page.dark {\n\t\t--page-background: #1a1a1a;\n\t\t--tabs-background: #242424;\n\t\t--title-color: #e5e5e5;\n\t\t--secondary-text-color: #999999;\n\t\t--meta-color: #777777;\n\t\t--rank-color: #666666;\n\t\t--domain-color: #666666;\n\t\t--border-color: #333333;\n\t\t--hover-background: #2a2a2a;\n\t\t--modal-overlay: rgba(0, 0, 0, 0.75);\n\t}\n\n\t.theme-toggle {\n\t\tbackground: none;\n\t\tborder: none;\n\t\tcursor: pointer;\n\t\tpadding: 6px;\n\t\tborder-radius: 6px;\n\t\tcolor: rgba(255, 255, 255, 0.9);\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\ttransition: background 0.15s;\n\t}\n\t.theme-toggle:hover {\n\t\tbackground: rgba(255, 255, 255, 0.15);\n\t}\n</style>",
	"design": [
		{
			"id": "body-font",
			"name": "Font",
			"css_var": "--body-font",
			"value": "system-ui, sans-serif",
			"type": "font",
			"description": "Main font for all text"
		},
		{
			"id": "page-background",
			"name": "Page Background",
			"css_var": "--page-background",
			"value": "#fafafa",
			"type": "color",
			"description": "Overall page background"
		},
		{
			"id": "header-background",
			"name": "Header Background",
			"css_var": "--header-background",
			"value": "#ff6600",
			"type": "color",
			"description": "Header bar color (HN orange)"
		},
		{
			"id": "tabs-background",
			"name": "Tabs Background",
			"css_var": "--tabs-background",
			"value": "#ffffff",
			"type": "color",
			"description": "Background color for tab navigation"
		},
		{
			"id": "accent-color",
			"name": "Accent Color",
			"css_var": "--accent-color",
			"value": "#ff6600",
			"type": "color",
			"description": "Primary accent color for active tabs and links"
		},
		{
			"id": "title-color",
			"name": "Title Color",
			"css_var": "--title-color",
			"value": "#1a1a1a",
			"type": "color",
			"description": "Story title color"
		},
		{
			"id": "secondary-text-color",
			"name": "Secondary Text",
			"css_var": "--secondary-text-color",
			"value": "#666666",
			"type": "color",
			"description": "Secondary text color for tabs and loading"
		},
		{
			"id": "meta-color",
			"name": "Meta Text",
			"css_var": "--meta-color",
			"value": "#828282",
			"type": "color",
			"description": "Meta info color (points, time, comments)"
		},
		{
			"id": "rank-color",
			"name": "Rank Color",
			"css_var": "--rank-color",
			"value": "#999999",
			"type": "color",
			"description": "Story rank number color"
		},
		{
			"id": "domain-color",
			"name": "Domain Color",
			"css_var": "--domain-color",
			"value": "#999999",
			"type": "color",
			"description": "Domain text color next to titles"
		},
		{
			"id": "border-color",
			"name": "Border Color",
			"css_var": "--border-color",
			"value": "#e5e5e5",
			"type": "color",
			"description": "Border and divider color"
		},
		{
			"id": "hover-background",
			"name": "Hover Background",
			"css_var": "--hover-background",
			"value": "#f5f5f5",
			"type": "color",
			"description": "Background color on tab hover"
		}
	],
	"content": [
		{
			"id": "app_title",
			"name": "App Title",
			"type": "text",
			"value": "HN Reader",
			"description": "Title shown in header"
		},
		{
			"id": "visit_hn",
			"name": "Visit HN Link",
			"type": "text",
			"value": "Visit HN",
			"description": "Link text to Hacker News"
		},
		{
			"id": "loading_message",
			"name": "Loading Message",
			"type": "text",
			"value": "Loading stories...",
			"description": "Shown while fetching"
		},
		{
			"id": "retry_button",
			"name": "Retry Button",
			"type": "text",
			"value": "Try Again",
			"description": "Error retry button text"
		}
	],
	"data": {
		"saved": {
			"schema": [
				{
					"name": "story_id",
					"type": "number"
				},
				{
					"name": "title",
					"type": "text"
				},
				{
					"name": "url",
					"type": "url"
				},
				{
					"name": "by",
					"type": "text"
				},
				{
					"name": "score",
					"type": "number"
				},
				{
					"name": "descendants",
					"type": "number"
				}
			],
			"records": [],
			"icon": "lucide:bookmark"
		}
	}
}
